\section{実装内容と開発背景を含む説明文の抽出手法}


\ref{section:Formative_Study}章にて述べたプログラマを対象としたインタビューにより，コード断片の理解においてプルリクエストに含まれる情報が有用であることが示唆された．
また，コード断片を理解する上で，そのコード断片が何を実行するかという実装内容だけでなく，開発背景も理解することが重要であることが明らかとなった．
しかし既存のシステムでは，コード変更の説明文に含まれる情報を，実装内容や開発背景といった情報に分類することは行われていない．
そこで我々は，プルリクエストの説明文内の文章の中から，関連するコード変更の実装方法と関連するコード変更の実装理由を抽出するための分類器を実装した．


\subsection{データセットの構築}

% \shibato{}{ExecutionとRationaleの説明が必要？}

%プルリクエストの説明文に含まれる文章をExecutionおよびRationaleに分類するためには，それらのカテゴリがラベルづけされた文章のデータセットを構築する必要がある．
%そこで我々は，GitHubのリポジトリに登録されているプルリクエストのテンプレートを活用することとした．
開発者が実装内容や開発背景といった重要な情報を漏れなくプルリクエストに記述する事を促すために，GitHubのリポジトリにはマークダウンで書かれたプルリクエストのテンプレートを登録することができる~\footnote{\url{https://help.github.com/articles/creating-a-pull-request-template-for-your-repository}}．
テンプレートに沿ってプルリクエストの説明文を記述することで，他の開発者がコード変更を理解するために必要な情報を網羅したプルリクエストを作成することができる．
テンプレート内のヘッダーには，実装内容（Execution）に該当するヘッダー（``Implementation Details''など）や，開発背景（Rationale）に該当するヘッダー（``Motivation and Context''など）などが多く採用されている．
そのようなヘッダーの下に記述されている文章を抽出することで，分類器の学習に必要なラベルづけされたデータセットを構築することとした．

以上のようなデータをGitHubから収集するために，我々は次の条件を満たすリポジトリに存在するプルリクエストのデータを抽出した．

\begin{description}
\item[条件1] リポジトリのスター数が100以上であること．
\item[条件2] プルリクエストのテンプレートがリポジトリに登録されており， Executionに関係する節かRationaleに関係する節がテンプレート内に存在すること．
\end{description}

条件1はリポジトリの開発者数の目安として掲げたものである．
スター数が大きいものほどGitHub上での開発が盛んであり，条件2を満たすプルリクエストを多く取得できるだろうと考えた．
また，条件2に適応することで，前述のようにラベルづけされたデータを収集することができる．

GitHubから条件1と条件2を満たすデータを収集した結果，26のリポジトリと4061件のプルリクエストのデータを集めることができた．
その26のリポジトリに登録されているプルリクエストのテンプレートについて，著者の2人がExecutionまたはRationaleに該当するヘッダーを手動で抽出した．
そして，それらのヘッダーの下に存在する文章を抽出することにより，Executionの文章を3141件，Rationaleの文章を3451件を得た．
さらに，抽出した文章内に含まれるマークダウン表記と絵文字を削除する事で，分類器の学習用のデータセットを構築した．


% GitHub上のリポジトリの内，以下の条件を満たすものから PR と Issue を取得し，説明文の中から上述の Why と How に関する文章を抽出することで学習用のデータセットを作成した．
% \begin{description}
% \item[条件1] リポジトリのスター数が100以上であること．
% \item[条件2] プルリクエストのテンプレートが存在し， Whyに関係する節かHowに関係する節がテンプレート内に存在すること．
% \end{description}

% 条件1はリポジトリの開発者数の目安として掲げたものである．
% スター数が大きいものほどGitHub上での開発が盛んであり，条件2を満たすプルリクエストを多く取得できるだろうと考えた．
% 条件2はプルリクエストの説明文からWhyまたはHowに該当する文章を抽出するための条件である．
% 開発者が開発目的や実装方法といった重要な情報を漏れなくプルリクエストに記述する事を支援するために，GitHubのリポジトリではマークダウンで書かれたプルリクエストのテンプレートを登録することができる~\footnote{\url{https://help.github.com/articles/creating-a-pull-request-template-for-your-repository}}．
% 開発者はテンプレートのヘッダーで指定された内容をプルリクエストの説明文に書く事で，他の開発者がコード変更を理解するために必要な情報を網羅したプルリクエストを簡単に作成できるようになる．
% 我々は収集したプルリクエストのテンプレートから，Whyに該当するヘッダー（``Motivation and Context''など）とHowに該当するヘッダー（``Implementation Details''など）を指定した．
% そして，それらのヘッダーの下に記述されている文章を，WhyおよびHowを意味する文章として抽出し，分類器の学習用のデータセットとした．

% 我々は条件1および条件2を満たす 26 のレポジトリから，4061件のプルリクエストをGitHubから収集した．
% これらの説明文の中から，Why に関係する文章を3451件，Howに関係する文章を3141件抽出した．
% そして，抽出した文章内に含まれるマークダウン表記，絵文字，urlを削除する事で，分類器の学習用のデータセットを構築した．


% \begin{table}[t]
%     \centering
%      \caption{SVMの結果}
%     \label{table:svm}
%     \begin{tabular}{c | c} \Hline
%      特徴量 &F値 \\ \hline \hline
%      bag-of-words & 0.64 \\
%      tf-idf & 0.68 \\
%      word2vec & 0.72 \\
%      word2vec+tf-idf & 0.73 \\
%     \end{tabular}
% \end{table}


\subsection{分類器の実装と評価}

分類器の実装にはサポートベクターマシンを用いた．
学習に必要な特徴量は，文章の分類において一般的に使用されているbag-of-words， tf-idf，word2vecを用いた~\cite{pmlr-v32-le14}．
さらに，tf-idfとword2vecが抽出する情報が互いに補完的な役割を果たすことが報告されているため~\cite{SVM-word2vec-tfidf}，本研究においてもword2vecをtf-idfにより重み付けした特徴量（word2vec+tf-idf）も利用した．
それぞれの特徴量を用いて分類器を学習し，10分割交差検証法により分類器の精度を検証した結果，bag-of-wordsを用いた時のF値の平均が0.64，tf-idfを用いた時のF値の平均が0.68，word2vecを用いた時のF値の平均が0.72，word2vec+tf-idfを用いた時のF値の平均が0.73であった．
以上よりword2vec+tf-idfを用いた時が最も精度が高かったため，word2vec+tf-idfを用いて学習を行った分類器をCodeGlass上に実装した．

% \subsubsection{分類器によるCodeGlassの機能}


% 学習した分類器を用いることで，CodeGlassはユーザが選択したコード断片に関連するプルリクエストを，Executionの情報の量が多い順，およびRationaleの情報の量が多い順に並び替えることができる．
% ただし情報の量は，プルリクエスト内の説明文を分割し生成された各文章に対する，ExecutionまたはRationaleへの分類確率の和と定義した．
% プルリクエストの説明文の分割方法は，説明文にマークダウンが使用されていた場合，ヘッダーを区切りとして分割した．
% また，マークダウンが使用されていない説明文は，空行を区切りとして分割される．
% そして，分割された文章ごとにExecutionおよびRationaleへの分類確率を計算し，それらの和を各プルリクエストに含まれるExecutionおよびRationaleに関する情報の量とする．
% 図~\ref{fig:interface1}~(1)に示すように，CodeGlassは計算した情報の量を用いてプルリクエストを並び替えることができる．
% これによりユーザは，選択したコード断片の調査目的に合わせて，プルリクエストの表示順序を変更することができる．

% 各プルリクエストに含まれるExecutionおよびRationaleの情報の量を計算するために，CodeGlassはまずプルリクエストの説明文を分割する．
% 説明文にマークダウンが使用されていた場合，ヘッダーを区切りとして分割される．
% マークダウンが使用されていない説明文は，空行を区切りとして分割される．

図~\ref{fig:interface1}~(1)に示すボタンから，ユーザはプルリクエストの表示順を時系列順，Executionに関する情報が多い順，Rationaleに関する情報が多い順に並び替えることができる．
さらにプルリクエストの詳細画面では，ExecutionおよびRationaleに80\%以上の確率で分類されると推定された文章がハイライトされる．
図~\ref{fig:interface2}~(4)に示すように，Executionに分類される文章は緑色の，Rationaleに分類される文章は青色の文字で表示することで，ユーザの情報収集を支援することが可能となっている．


